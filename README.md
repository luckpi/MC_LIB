# Motor_Control

## FOC处于测试阶段，目前测试反转功能

单片机: 基于HC32-F030J8TA(ARM Cortex-M0+内核) </br>
开发平台：Keil5     
电流采样：`双电阻采样`      
角度估算：`滑膜估算器` + `反正切`       
项目介绍：本项目通过双电阻采样`下管对地电流`。`下管导通中间时刻采样` 提高电流准确性。通过滑膜估算器对电流的估算，得到反电动势，通过两次低通滤波后反正切获取估算角。     
Tip：不同电机，需要调整相电感，相电阻，工作电压，最大电流，启动的力矩。
* 问题总结：  
    *  之前一直困扰我的切入闭环PI速度环问题，其实不是PI的锅，是因为相电流采样电路里的电容太大导致的信号延迟太高，使得估算角度的延时也变高了，通过加大延时就转起来了。（第二版硬件解决）
    * 之前用的反正切算法计算误差过大，容易卡死，使用`CORDIC`之后就变得稳定多了。
    * 采样电路使用 `正向放大器` ,PCB布线尽可能的`避开大电流` ，铺地时注意隔开（第二版硬件实现）
    * 一直切不进闭环的原因找到了，是反正切的计算参数问题，一直以为是电流采样滤波造成的相位延时。

***42BLF01 主要电气参数***  


| 名称           | 参数  | 单位 | 名称       | 参数  | 单位   |
| -------------- | ----- | ---- | ---------- | ----- | ------ |
| 绕组形式       | 星形  |      | 峰值转矩   | 0.18  | Nm     |
| 传感器电角度   | 120   | °    | 峰值电流   | 4.6   | A      |
| 磁极数         | 8     |      | 线电阻     | 1.8   | Ω      |
| 相数           | 3     |      | 线电感     | 0.54  | mH     |
| 额定电压(直流) | 24    | V    | 转矩常数   | 0.042 | Nm/A   |
| 额定转速       | 4000  | rpm  | 反电势常数 | 4.4   | V/krpm |
| 保持力矩       | 0.063 | Nm   | 转动惯量   | 24    | gcm^2  |
| 输出功率       | 26    | W    |
